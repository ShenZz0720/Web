<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>商品列表 - Cookies购物车系统</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <div class="container">
    <header>
      <h1><i class="fas fa-store"></i> 电子产品商城</h1>
      <p class="subtitle">使用Cookies实现跨页面购物车功能</p>
    </header>
    
    <div class="panel">
      <h2 class="panel-title"><i class="fas fa-laptop"></i> 热门商品</h2>
      
      <div class="product-grid">
        <div class="product-card">
          <img src="https://via.placeholder.com/200x150?text=智能手机" alt="智能手机" class="product-image">
          <div class="product-name">智能手机</div>
          <div class="product-price">¥2999</div>
          <button class="btn btn-add" data-id="1" data-name="智能手机" data-price="2999">
            <i class="fas fa-cart-plus"></i> 加入购物车
          </button>
        </div>
        
        <div class="product-card">
          <img src="https://via.placeholder.com/200x150?text=无线耳机" alt="无线耳机" class="product-image">
          <div class="product-name">无线耳机</div>
          <div class="product-price">¥899</div>
          <button class="btn btn-add" data-id="2" data-name="无线耳机" data-price="899">
            <i class="fas fa-cart-plus"></i> 加入购物车
          </button>
        </div>
        
        <div class="product-card">
          <img src="https://via.placeholder.com/200x150?text=平板电脑" alt="平板电脑" class="product-image">
          <div class="product-name">平板电脑</div>
          <div class="product-price">¥4299</div>
          <button class="btn btn-add" data-id="3" data-name="平板电脑" data-price="4299">
            <i class="fas fa-cart-plus"></i> 加入购物车
          </button>
        </div>
        
        <div class="product-card">
          <img src="https://via.placeholder.com/200x150?text=智能手表" alt="智能手表" class="product-image">
          <div class="product-name">智能手表</div>
          <div class="product-price">¥1299</div>
          <button class="btn btn-add" data-id="4" data-name="智能手表" data-price="1299">
            <i class="fas fa-cart-plus"></i> 加入购物车
          </button>
        </div>
      </div>
      
      <a href="cart.html" class="btn btn-view-cart">
        <i class="fas fa-shopping-cart"></i> 查看购物车
      </a>
    </div>
    
    <div class="cookie-info">
      <h3><i class="fas fa-cookie-bite"></i> Cookies跨页面原理</h3>
      <p>购物车数据以JSON格式存储在名为<span class="highlight">shopping_cart</span>的Cookie中：</p>
      <div class="cookie-code">
        // 所有页面共享同一个Cookie<br>
        document.cookie = "shopping_cart=[{id:'1',name:'智能手机',...}];<br>
        expires=Thu, 18 Dec 2025 12:00:00 UTC; path=/";
      </div>
      <p class="highlight">所有页面在同一个域名下，因此可以访问相同的Cookies数据</p>
    </div>
  </div>

  <script>
    // 页面加载时初始化
    document.addEventListener('DOMContentLoaded', () => {
      // 为所有"加入购物车"按钮添加事件监听
      document.querySelectorAll('.btn-add').forEach(button => {
        button.addEventListener('click', () => {
          const productId = button.dataset.id;
          const productName = button.dataset.name;
          const productPrice = button.dataset.price;
          addToCart(productId, productName, productPrice);
          
          alert(`已将 ${productName} 添加到购物车！`);
        });
      });
    });

    // 获取购物车数据（从Cookie）
    function getCart() {
      const cartCookie = getCookie('shopping_cart');
      return cartCookie ? JSON.parse(cartCookie) : [];
    }

    // 保存购物车数据（到Cookie）
    function saveCart(cart) {
      const cartJson = JSON.stringify(cart);
      // 设置Cookie有效期为30天
      const date = new Date();
      date.setTime(date.getTime() + (30 * 24 * 60 * 60 * 1000));
      const expires = "expires=" + date.toUTCString();
      document.cookie = `shopping_cart=${cartJson}; ${expires}; path=/`;
    }

    // 获取Cookie的辅助函数
    function getCookie(name) {
      const cookies = document.cookie.split(';');
      for(let cookie of cookies) {
        cookie = cookie.trim();
        if(cookie.startsWith(name + '=')) {
          return decodeURIComponent(cookie.substring(name.length + 1));
        }
      }
      return null;
    }

    // 添加商品到购物车
    function addToCart(productId, productName, productPrice) {
      const cart = getCart();
      const existingItem = cart.find(item => item.id === productId);
      
      if(existingItem) {
        existingItem.quantity += 1;
      } else {
        cart.push({
          id: productId,
          name: productName,
          price: parseFloat(productPrice),
          quantity: 1
        });
      }
      
      saveCart(cart);
    }
  </script>
</body>
</html>